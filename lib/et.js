// Generated by CoffeeScript 1.4.0
var Et, Restify;

Restify = require('restify');

Et = (function() {

  function Et() {
    this.session = require('./session');
    this.model = require('./model');
    this.auth = require('./auth');
    this.route = require('./route');
  }

  Et.prototype.al = function(opts) {
    var et, gotApp;
    if (opts == null) {
      opts = {};
    }
    console.log('init et.al()');
    this.resource = opts.resource;
    et = this;
    gotApp = opts.app !== void 0;
    if (!(opts.app || opts.port)) {
      throw 'et.al() requires opts.app or opts.port';
    }
    if (!gotApp) {
      opts.app = Restify.createServer();
      opts.app.listen(opts.port, function() {});
    }
    this.first = function(req, res, next) {
      req.et = et;
      return next();
    };
    opts.app.use(this.first);
    this.last = function(req, res, next) {
      console.warn('UNHANDLED request ', req.path);
      return next();
    };
    this.session.config(this, opts);
    this.model.config(this, opts);
    this.auth.config(this, opts);
    this.route.config(this, opts);
    if (gotApp) {
      return this.last;
    }
    opts.app.use(this.first);
    return opts.app;
  };

  return Et;

})();

module.exports = new Et();
